{"version":3,"sources":["tools/Popup/index.js"],"names":["Popup","props","context","target","container","state","isShow","show","popupShow","clearPopup","insertBody","setState","appendToBody","mountClick","autoClose","bind","document","addEventListener","createElement","body","appendChild","unstable_renderSubtreeIntoContainer","generateChild","e","self","findDOMNode","contains","close","triggerProp","child","children","onHide","removeChild","removeEventListener","Element","Component","defaultProps","placement","trigger","spacing","className","triggle","PopupInner","position","positionLeft","positionTop","getTarget","updatePosition","stopPropagation","targetBox","offset","console","log","containBox","triggleBox","width","height","pos","containerW","containerH","top","bottom","Object","assign","left","triggleClass","style","triggleStyle","cloneElement","preventPropagation"],"mappings":"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","file":"index.js","sourceRoot":"/Users/liangdong06/work/react-tools","sourcesContent":["/**\n * @file Popup\n * @author liangdong06\n */\n\n'use strict';\n\nimport React, {cloneElement} from 'react';\nimport ReactDOM from 'react-dom';\nimport domHelper, {query} from 'dom-helpers';\n\nimport './Popup.less';\n\nexport default class Popup extends React.Component {\n\n    static defaultProps = {\n        placement: 'top',\n        trigger: 'click',\n        spacing: 5,\n        className: '',\n        triggle: true,\n        insertBody: false\n    }\n\n    constructor(props, context) {\n        super(props);\n        if (!this.props.target) {\n            throw 'You may forget to add a target';\n        }\n        this.container = null;\n        this.state = {\n            isShow: props.show\n        };\n    }\n\n    componentWillReceiveProps(props) {\n        if (props.show) {\n            this.popupShow();\n        }\n        else {\n            this.clearPopup();\n        }\n    }\n\n    popupShow() {\n        if (!this.props.insertBody) {\n            this.setState({\n                isShow: true\n            });\n        }\n        else if (!this.container) {\n            this.appendToBody();\n        }\n        if (!this.mountClick) {\n            this.mountClick = this.autoClose.bind(this);\n            document.addEventListener('click', this.mountClick, false);\n        }\n    }\n\n    /**\n     * 插入body\n     */\n    appendToBody() {\n        this.container = document.createElement('div');\n        document.body.appendChild(this.container);\n        ReactDOM.unstable_renderSubtreeIntoContainer(\n            this,\n            this.generateChild(),\n            this.container\n        );\n    }\n\n    /**\n     * 点击屏幕关闭popup\n     * @param {Object} e event\n     */\n    autoClose(e) {\n        const self = ReactDOM.findDOMNode(this);\n        if ((this.container && !query.contains(this.container, e.target))\n            || (self && !query.contains(self, e.target))) {\n            this.close();\n        }\n    }\n\n    /**\n     * 生成子节点\n     * @return {jsx} 子节点\n     */\n    generateChild() {\n        const triggerProp = {\n            close: this.close.bind(this)\n        };\n        const child = cloneElement(this.props.children, triggerProp);\n        return (<PopupInner {...this.props} close={this.close.bind(this)} >\n                {child}\n        </PopupInner>);\n    }\n\n    /**\n     * 关闭Popup\n     */\n    close() {\n        this.clearPopup();\n        if (this.props.onHide) {\n            this.props.onHide();\n        }\n    }\n\n    /**\n     * 清除Popup\n     */\n    clearPopup() {\n        if (this.container) {\n            document.body.removeChild(this.container);\n            this.container = null;\n        }\n        else if (!this.props.insertBody) {\n            this.setState({\n                isShow: false\n            });\n        }\n        document.removeEventListener('click', this.mountClick);\n        this.mountClick = null;\n    }\n    componentWillUnmount() {\n        this.clearPopup();\n    }\n    render() {\n        const {children, ...props} = this.props;\n\n        if (!this.state.isShow) {\n            return null;\n        }\n        const Element = !this.props.insertBody ? this.generateChild() : null;\n        return Element;\n    }\n}\n\nclass PopupInner extends React.Component {\n    constructor(props, context) {\n        super(props);\n        this.state = {\n            position: {\n                positionLeft: 0,\n                positionTop: 0\n            },\n            triggle: {\n                placement: 'top',\n                positionLeft: 0,\n                positionTop: 0\n            }\n        };\n    }\n    componentDidMount() {\n        this.target = this.getTarget();\n        this.container = ReactDOM.findDOMNode(this);\n        this.updatePosition();\n    }\n    componentDidUpdate() {\n        // const pos = this.state.position;\n        // const container = ReactDOM.findDOMNode(this);\n        // const containBox = query.offset(container);\n        // if (pos.containerW !== containBox.width\n        //     || pos.containerH !== containBox.height) {\n        //     // this.updatePosition();\n        // }\n    }\n    getTarget() {\n        if (typeof this.props.target === 'function') {\n            return this.props.target();\n        }\n        return this.props.target;\n    }\n    preventPropagation(e) {\n        e.stopPropagation();\n    }\n    updatePosition() {\n\n        const targetBox = this.props.insertBody\n                        ? query.offset(this.target) : query.position(this.target);\n        console.log(query.offset(this.target));\n        console.log(query.position(this.target));\n        const containBox = query.offset(this.container);\n        const triggleBox = {\n            width: 16,\n            height: 16\n        };\n        let pos = {\n            containerW: containBox.width,\n            containerH: containBox.height\n        };\n        let triggle = {};\n        // 上部高度\n        const top = targetBox.top - containBox.height - triggleBox.height / 2 - this.props.spacing;\n        const bottom = targetBox.top + targetBox.height + triggleBox.height / 2 + this.props.spacing;\n        switch (this.props.placement) {\n            case 'right':\n                Object.assign(pos, {\n                    positionLeft: targetBox.left + targetBox.width,\n                    positionTop: targetBox.top\n                });\n                break;\n            case 'top':\n                Object.assign(pos, {\n                    positionLeft: targetBox.left,\n                    positionTop: top\n                });\n                triggle = {\n                    placement: 'top',\n                    positionLeft: (targetBox.width - triggleBox.width) / 2,\n                    positionTop: containBox.height - 1\n                };\n                break;\n            case 'right top':\n                Object.assign(pos, {\n                    positionLeft: targetBox.left - containBox.width + targetBox.width,\n                    positionTop: top\n                });\n                triggle = {\n                    placement: 'top',\n                    positionLeft: containBox.width - (targetBox.width + triggleBox.width) / 2,\n                    positionTop: containBox.height - 1\n                };\n                break;\n            case 'bottom left':\n                Object.assign(pos, {\n                    positionLeft: targetBox.left,\n                    positionTop: bottom\n                });\n                triggle = {\n                    placement: 'bottom',\n                    positionLeft: (targetBox.width + triggleBox.width) / 2,\n                    positionTop: - triggleBox.height + 1\n                };\n            default:\n                // statements_def\n                break;\n        }\n        this.setState({\n            position: pos,\n            triggle: triggle\n        });\n    }\n    render() {\n        const className = 'popup ' + this.props.className;\n        const triggleClass = 'triggle ' + this.state.triggle.placement;\n        const style = {\n            left: this.state.position.positionLeft,\n            top: this.state.position.positionTop\n        };\n        const triggleStyle = {\n            left: this.state.triggle.positionLeft,\n            top: this.state.triggle.positionTop\n        };\n        const child = React.cloneElement(this.props.children, {\n        });\n        return (\n            <div id='popup' className={className} style={style} onClick={this.preventPropagation.bind(this)}>\n                {\n                    this.props.triggle\n                        ? <span className={triggleClass} style={triggleStyle}>\n                            <i className='tri triggle-outer'>\n                            </i>\n                            <i className='tri triggle-inner'></i>\n                        </span>\n                        : null\n                }\n                {child}\n            </div>\n        );\n    }\n}\n"]}