{"version":3,"sources":["node_modules/remarkable/lib/parser_inline.js"],"names":["Ruler","require","StateInline","utils","_rules","ParserInline","ruler","i","length","push","validateLink","prototype","skipToken","state","rules","getRules","len","pos","cached_pos","cacheGet","cacheSet","tokenize","end","posMax","ok","pending","src","pushPending","parse","str","options","env","outTokens","url","BAD_PROTOCOLS","trim","toLowerCase","replaceEntities","indexOf","split","module","exports"],"mappings":"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","file":"parser_inline.js","sourceRoot":"/Users/liangdong06/work/react-tools","sourcesContent":["'use strict';\n\n/**\n * Local dependencies\n */\n\nvar Ruler       = require('./ruler');\nvar StateInline = require('./rules_inline/state_inline');\nvar utils       = require('./common/utils');\n\n/**\n * Inline Parser `rules`\n */\n\nvar _rules = [\n  [ 'text',            require('./rules_inline/text') ],\n  [ 'newline',         require('./rules_inline/newline') ],\n  [ 'escape',          require('./rules_inline/escape') ],\n  [ 'backticks',       require('./rules_inline/backticks') ],\n  [ 'del',             require('./rules_inline/del') ],\n  [ 'ins',             require('./rules_inline/ins') ],\n  [ 'mark',            require('./rules_inline/mark') ],\n  [ 'emphasis',        require('./rules_inline/emphasis') ],\n  [ 'sub',             require('./rules_inline/sub') ],\n  [ 'sup',             require('./rules_inline/sup') ],\n  [ 'links',           require('./rules_inline/links') ],\n  [ 'footnote_inline', require('./rules_inline/footnote_inline') ],\n  [ 'footnote_ref',    require('./rules_inline/footnote_ref') ],\n  [ 'autolink',        require('./rules_inline/autolink') ],\n  [ 'htmltag',         require('./rules_inline/htmltag') ],\n  [ 'entity',          require('./rules_inline/entity') ]\n];\n\n/**\n * Inline Parser class. Note that link validation is stricter\n * in Remarkable than what is specified by CommonMark. If you\n * want to change this you can use a custom validator.\n *\n * @api private\n */\n\nfunction ParserInline() {\n  this.ruler = new Ruler();\n  for (var i = 0; i < _rules.length; i++) {\n    this.ruler.push(_rules[i][0], _rules[i][1]);\n  }\n\n  // Can be overridden with a custom validator\n  this.validateLink = validateLink;\n}\n\n/**\n * Skip a single token by running all rules in validation mode.\n * Returns `true` if any rule reports success.\n *\n * @param  {Object} `state`\n * @api privage\n */\n\nParserInline.prototype.skipToken = function (state) {\n  var rules = this.ruler.getRules('');\n  var len = rules.length;\n  var pos = state.pos;\n  var i, cached_pos;\n\n  if ((cached_pos = state.cacheGet(pos)) > 0) {\n    state.pos = cached_pos;\n    return;\n  }\n\n  for (i = 0; i < len; i++) {\n    if (rules[i](state, true)) {\n      state.cacheSet(pos, state.pos);\n      return;\n    }\n  }\n\n  state.pos++;\n  state.cacheSet(pos, state.pos);\n};\n\n/**\n * Generate tokens for the given input range.\n *\n * @param  {Object} `state`\n * @api private\n */\n\nParserInline.prototype.tokenize = function (state) {\n  var rules = this.ruler.getRules('');\n  var len = rules.length;\n  var end = state.posMax;\n  var ok, i;\n\n  while (state.pos < end) {\n\n    // Try all possible rules.\n    // On success, the rule should:\n    //\n    // - update `state.pos`\n    // - update `state.tokens`\n    // - return true\n    for (i = 0; i < len; i++) {\n      ok = rules[i](state, false);\n\n      if (ok) {\n        break;\n      }\n    }\n\n    if (ok) {\n      if (state.pos >= end) { break; }\n      continue;\n    }\n\n    state.pending += state.src[state.pos++];\n  }\n\n  if (state.pending) {\n    state.pushPending();\n  }\n};\n\n/**\n * Parse the given input string.\n *\n * @param  {String} `str`\n * @param  {Object} `options`\n * @param  {Object} `env`\n * @param  {Array} `outTokens`\n * @api private\n */\n\nParserInline.prototype.parse = function (str, options, env, outTokens) {\n  var state = new StateInline(str, this, options, env, outTokens);\n  this.tokenize(state);\n};\n\n/**\n * Validate the given `url` by checking for bad protocols.\n *\n * @param  {String} `url`\n * @return {Boolean}\n */\n\nfunction validateLink(url) {\n  var BAD_PROTOCOLS = [ 'vbscript', 'javascript', 'file', 'data' ];\n  var str = url.trim().toLowerCase();\n  // Care about digital entities \"javascript&#x3A;alert(1)\"\n  str = utils.replaceEntities(str);\n  if (str.indexOf(':') !== -1 && BAD_PROTOCOLS.indexOf(str.split(':')[0]) !== -1) {\n    return false;\n  }\n  return true;\n}\n\n/**\n * Expose `ParserInline`\n */\n\nmodule.exports = ParserInline;\n"]}