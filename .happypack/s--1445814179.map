{"version":3,"sources":["node_modules/remarkable/lib/ruler.js"],"names":["Ruler","__rules__","__cache__","prototype","__find__","name","len","length","i","__compile__","self","chains","forEach","rule","enabled","alt","altName","indexOf","push","chain","fn","at","options","idx","opt","Error","before","beforeName","ruleName","splice","after","afterName","enable","list","strict","Array","isArray","disable","getRules","chainName","module","exports"],"mappings":"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","file":"ruler.js","sourceRoot":"/Users/liangdong06/work/react-tools","sourcesContent":["'use strict';\n\n/**\n * Ruler is a helper class for building responsibility chains from\n * parse rules. It allows:\n *\n *   - easy stack rules chains\n *   - getting main chain and named chains content (as arrays of functions)\n *\n * Helper methods, should not be used directly.\n * @api private\n */\n\nfunction Ruler() {\n  // List of added rules. Each element is:\n  //\n  // { name: XXX,\n  //   enabled: Boolean,\n  //   fn: Function(),\n  //   alt: [ name2, name3 ] }\n  //\n  this.__rules__ = [];\n\n  // Cached rule chains.\n  //\n  // First level - chain name, '' for default.\n  // Second level - digital anchor for fast filtering by charcodes.\n  //\n  this.__cache__ = null;\n}\n\n/**\n * Find the index of a rule by `name`.\n *\n * @param  {String} `name`\n * @return {Number} Index of the given `name`\n * @api private\n */\n\nRuler.prototype.__find__ = function (name) {\n  var len = this.__rules__.length;\n  var i = -1;\n\n  while (len--) {\n    if (this.__rules__[++i].name === name) {\n      return i;\n    }\n  }\n  return -1;\n};\n\n/**\n * Build the rules lookup cache\n *\n * @api private\n */\n\nRuler.prototype.__compile__ = function () {\n  var self = this;\n  var chains = [ '' ];\n\n  // collect unique names\n  self.__rules__.forEach(function (rule) {\n    if (!rule.enabled) {\n      return;\n    }\n\n    rule.alt.forEach(function (altName) {\n      if (chains.indexOf(altName) < 0) {\n        chains.push(altName);\n      }\n    });\n  });\n\n  self.__cache__ = {};\n\n  chains.forEach(function (chain) {\n    self.__cache__[chain] = [];\n    self.__rules__.forEach(function (rule) {\n      if (!rule.enabled) {\n        return;\n      }\n\n      if (chain && rule.alt.indexOf(chain) < 0) {\n        return;\n      }\n      self.__cache__[chain].push(rule.fn);\n    });\n  });\n};\n\n/**\n * Ruler public methods\n * ------------------------------------------------\n */\n\n/**\n * Replace rule function\n *\n * @param  {String} `name` Rule name\n * @param  {Function `fn`\n * @param  {Object} `options`\n * @api private\n */\n\nRuler.prototype.at = function (name, fn, options) {\n  var idx = this.__find__(name);\n  var opt = options || {};\n\n  if (idx === -1) {\n    throw new Error('Parser rule not found: ' + name);\n  }\n\n  this.__rules__[idx].fn = fn;\n  this.__rules__[idx].alt = opt.alt || [];\n  this.__cache__ = null;\n};\n\n/**\n * Add a rule to the chain before given the `ruleName`.\n *\n * @param  {String}   `beforeName`\n * @param  {String}   `ruleName`\n * @param  {Function} `fn`\n * @param  {Object}   `options`\n * @api private\n */\n\nRuler.prototype.before = function (beforeName, ruleName, fn, options) {\n  var idx = this.__find__(beforeName);\n  var opt = options || {};\n\n  if (idx === -1) {\n    throw new Error('Parser rule not found: ' + beforeName);\n  }\n\n  this.__rules__.splice(idx, 0, {\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n/**\n * Add a rule to the chain after the given `ruleName`.\n *\n * @param  {String}   `afterName`\n * @param  {String}   `ruleName`\n * @param  {Function} `fn`\n * @param  {Object}   `options`\n * @api private\n */\n\nRuler.prototype.after = function (afterName, ruleName, fn, options) {\n  var idx = this.__find__(afterName);\n  var opt = options || {};\n\n  if (idx === -1) {\n    throw new Error('Parser rule not found: ' + afterName);\n  }\n\n  this.__rules__.splice(idx + 1, 0, {\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n/**\n * Add a rule to the end of chain.\n *\n * @param  {String}   `ruleName`\n * @param  {Function} `fn`\n * @param  {Object}   `options`\n * @return {String}\n */\n\nRuler.prototype.push = function (ruleName, fn, options) {\n  var opt = options || {};\n\n  this.__rules__.push({\n    name: ruleName,\n    enabled: true,\n    fn: fn,\n    alt: opt.alt || []\n  });\n\n  this.__cache__ = null;\n};\n\n/**\n * Enable a rule or list of rules.\n *\n * @param  {String|Array} `list` Name or array of rule names to enable\n * @param  {Boolean} `strict` If `true`, all non listed rules will be disabled.\n * @api private\n */\n\nRuler.prototype.enable = function (list, strict) {\n  list = !Array.isArray(list)\n    ? [ list ]\n    : list;\n\n  // In strict mode disable all existing rules first\n  if (strict) {\n    this.__rules__.forEach(function (rule) {\n      rule.enabled = false;\n    });\n  }\n\n  // Search by name and enable\n  list.forEach(function (name) {\n    var idx = this.__find__(name);\n    if (idx < 0) {\n      throw new Error('Rules manager: invalid rule name ' + name);\n    }\n    this.__rules__[idx].enabled = true;\n  }, this);\n\n  this.__cache__ = null;\n};\n\n\n/**\n * Disable a rule or list of rules.\n *\n * @param  {String|Array} `list` Name or array of rule names to disable\n * @api private\n */\n\nRuler.prototype.disable = function (list) {\n  list = !Array.isArray(list)\n    ? [ list ]\n    : list;\n\n  // Search by name and disable\n  list.forEach(function (name) {\n    var idx = this.__find__(name);\n    if (idx < 0) {\n      throw new Error('Rules manager: invalid rule name ' + name);\n    }\n    this.__rules__[idx].enabled = false;\n  }, this);\n\n  this.__cache__ = null;\n};\n\n/**\n * Get a rules list as an array of functions.\n *\n * @param  {String} `chainName`\n * @return {Object}\n * @api private\n */\n\nRuler.prototype.getRules = function (chainName) {\n  if (this.__cache__ === null) {\n    this.__compile__();\n  }\n  return this.__cache__[chainName] || [];\n};\n\n/**\n * Expose `Ruler`\n */\n\nmodule.exports = Ruler;\n"]}